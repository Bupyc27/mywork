1) Установка LAMP:

а. Количество обработчиков Apache: на старте 4, максимум 6, каждые 100 запросов пересоздавать обработчики.

б. Apache должен быть запущен из-под отдельного (вручную созданного) пользователя. Домашний каталог должен быть вида /home/lskywalker

в. MySQL. Должен быть установлен форк от Percona (percona-server) версии 5.5 с директивами:

innodb_file_per_table = On.

default_storage_engine = MyISAM

временный каталог (tmpdir) для MySQL должен быть расположен на разделе /tmp с tmpfs (размер подобрать самостоятельно).

Так же включить сбор статистики userstat.

г. Для php должен быть подключен GD и FreeType. Должны стоять следующие директивы в настройках php для Apache:

display_errors = On

mbstring.func_overload = 2

mbstring.internal_encoding = UTF-8

Сессии должны храниться в tmpfs, смонтированной на каталог /tmp.

Доступ к сайту должен быть по IP-адресу виртуальной машины, на которой вы работаете.


2) Установка и настройка сервера под 1С-Битрикс:

Устанавливаем CMS 1С-Битрикс Управление сайтом -> Малый бизнес.

Выполняем все предложенные во время установки действия по настройке сервера.

Тип таблиц для БД CMS должен быть InnoDB.

После установки заходим в Административную часть и выполняем проверку сайта (Настройка - Инструменты - Проверка сайта). Все пункты кроме почты должны быть зелеными.

После это заходим в Настройка - Производительность - Панель производительности и выполняем тестирование конфигурации, устраняем все недочеты. Из предложенных акселераторов выбираем APC.

Заходим в Настройки - Производительность - Сервер БД и устраняем все сообщения, отмеченные красным (кроме uptime и кол-ва разрывов).

После того, как настройка выполнена и сообщений об ошибках нет, выполняем тестирование конфигурации в Панели производительности, создаем скриншот результата.


3) Установка NGinx как Frontend к Apache:

NGinx должен "слушать" порт 80, Apache - порт 80 на 127.0.0.1.

Все файлы из списка (jpg|jpeg|gif|png|css|zip|tgz|gz|rar|bz2|doc|xls|exe|pdf|ppt|txt|tar|mid|midi|wav|bmp|rtf|js|swf|f4v|flv|avi|wmv|mp3|mp4) должны обрабатываться NGinx-ом, все остальные запросы передаются на Apache.

Также должно быть включено сжатие для application/x-javascript text/plain application/xml text/css application/pdf text/xml, уровень компрессии - 8.

По ссылке http://31.186.98.217/phpinfo.php, где вместо 31.186.98.217 - IP-адрес вашей машины, должен быть расположен phpinfo.

REMOTE_ADDR должен совпадать с HTTP_X_REAL_IP (mod_rpaf).


В конце подключаем mod_status на /server-status. Он должен быть доступен только с localhost (проверить можно через telnet) и не доступен с внешней сети.sa